!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scrollama=t()}(this,function(){"use strict";function k({id:e,step:t,marginTop:o}){var{index:t,height:n}=t,e=`scrollama__debug-step--${e}-`+t;let r=document.querySelector("."+e);(r=r||(t=e,(e=document.createElement("div")).className="scrollama__debug-step "+t,e.style.position="fixed",e.style.left="0",e.style.width="100%",e.style.zIndex="9999",e.style.borderTop="2px solid black",e.style.borderBottom="2px solid black",(t=document.createElement("p")).style.position="absolute",t.style.left="0",t.style.height="1px",t.style.width="100%",t.style.borderTop="1px dashed black",e.appendChild(t),document.body.appendChild(e),e)).style.top=-1*o+"px",r.style.height=n+"px",r.querySelector("p").style.top=n/2+"px"}function M(e){console.error("scrollama error: "+e)}function q(e){return+e.getAttribute("data-scrollama-index")}function T(e){var t;return"string"==typeof e&&0<e.indexOf("px")?(t=+e.replace("px",""),isNaN(t)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:t}):"number"!=typeof e&&isNaN(+e)?null:(1<e&&err("offset value is greater than 1. Fallback to 1."),e<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,e),1)})}let A,N,z;function I(e){e=e?e.scrollTop:window.pageYOffset;console.log("scrollTop",e,A),A!==e&&((A=e)>N?z="down":A<N&&(z="up"),N=A)}return function(){let r={},s=function(){var t="abcdefghijklmnopqrstuvwxyz",e=Date.now(),o=[];for(let e=0;e<6;e+=1){var n=t[Math.floor(Math.random()*t.length)];o.push(n)}return""+o.join("")+e}(),p=[],c,d,u,g=0,t=!1,h=!1,m=!1,x=!1,i=[];function v(){r={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},i=[]}function b(e){e&&!t&&O(),!e&&t&&y(),t=e}function a(e,t){var o=q(e),n=p[o],e=(void 0!==t&&(n.progress=t),{element:e,index:o,progress:t,direction:z});"enter"===n.state&&r.stepProgress(e)}function o([e]){var t=q(e.target),t=p[t],e=e.target.offsetHeight;e!==t.height&&(t.height=e,n(t),E(t),w(t))}function l([e]){I(d);var t,o,{isIntersecting:e,target:n}=e;e?(t=q(e=n),o=p[t],e={element:e,index:t,direction:z},o.direction=z,o.state="enter",i[t]||r.stepEnter(e),x&&(i[t]=!0)):(e=q(o=n),(t=p[e]).state&&(e={element:o,index:e,direction:z},h&&("down"===z&&t.progress<1?a(o,1):"up"===z&&0<t.progress&&a(o,0)),t.direction=z,t.state="exit",r.stepExit(e)))}function f([e]){var t=q(e.target),t=p[t],{isIntersecting:e,intersectionRatio:o,target:n}=e;e&&"enter"===t.state&&a(n,o)}function n({observers:t}){Object.keys(t).map(e=>{t[e].disconnect()})}function y(){p.forEach(n)}function w(e){var t=new ResizeObserver(o);t.observe(e.node),e.observers.resize=t}function E(e){var t=window.innerHeight,o=e.offset||c,n="pixels"===o.format?1:t,o=o.value*n,n=e.height/2-o,t=e.height/2-(t-o),o=n+`px 0px ${t}px 0px`,r=u,o=new IntersectionObserver(l,{rootMargin:o,threshold:.5,root:r});o.observe(e.node),e.observers.step=o,m&&k({id:s,step:e,marginTop:n,marginBottom:t})}function e(e){var t=window.innerHeight,o=e.offset||c,n="pixels"===o.format?1:t,o=o.value*n,n=-o+e.height+`px 0px ${o-t}px 0px`,o=function(e,t){var o=Math.ceil(e/t),n=[],r=1/o;for(let e=0;e<o+1;e+=1)n.push(e*r);return n}(e.height,g),t=new IntersectionObserver(f,{rootMargin:n,threshold:o});t.observe(e.node),e.observers.progress=t}function O(){y(),p.forEach(w),p.forEach(E),h&&p.forEach(e)}const S={};return S.setup=({step:e,parent:t,offset:o=.5,threshold:n=4,progress:r=!1,once:s=!1,debug:i=!1,container:a=void 0,root:l=null})=>{var f;return f=a,console.log("window.pageYOffset",window.pageYOffset),A=0,N=0,document.addEventListener("scroll",()=>I(f)),(p=([e,t=document]=[e,t],("string"==typeof e?Array.from(t.querySelectorAll(e)):e instanceof Element?[e]:e instanceof NodeList?Array.from(e):e instanceof Array?e:[]).map((e,t)=>{return{index:t,direction:void 0,height:e.offsetHeight,node:e,observers:{},offset:T(e.dataset.offset),top:e.getBoundingClientRect().top+window.pageYOffset-(document.body.clientTop||0),progress:0,state:void 0}}))).length?(h=r,x=s,m=i,g=Math.max(1,+n),c=T(o),d=a,u=l,v(),p.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index)),b(!0)):M("no step elements"),S},S.enable=()=>(b(!0),S),S.disable=()=>(b(!1),S),S.destroy=()=>(b(!1),v(),S),S.resize=()=>(O(),S),S.offset=e=>null==e?c.value:(c=T(e),O(),S),S.onStepEnter=e=>("function"==typeof e?r.stepEnter=e:M("onStepEnter requires a function"),S),S.onStepExit=e=>("function"==typeof e?r.stepExit=e:M("onStepExit requires a function"),S),S.onStepProgress=e=>("function"==typeof e?r.stepProgress=e:M("onStepProgress requires a function"),S),S}});
